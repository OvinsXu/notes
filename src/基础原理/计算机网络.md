# 计算机网络笔记

> 该死,以前做的笔记竟然是手写的...现在还得重新整理!

## 网络层
  
0.具备的功能  

- 转发:将分组从路由器的输入端口转移到合适的输出端口  
- 路由：确定分组从源到目的经过的路径（路由算法）  
  
1.服务模型  

- 1.无连接服务（简化网络，复杂边缘，Internet）
  - 不事先确定好传输路径  
  - 每个分组独立确定  
  - 不同分组可能路径不同  
  - 数据报网络  
  - 每个分组携带目的地址，由路由器转发表根据路由算法转发，聚合转发,最长前缀优先原则  
  
- 2.连接服务（复杂网络，简化边缘，ATM电话）  
  - 事先确定好路径  
  - 系列分路径相同  
  - 传输结束后拆除连接  
  - 虚电路网络（VC）：信令协议（用于VC的建立维护拆除）  
  - 一条从源主机到目的主机的一条逻辑连接，呼叫建立--数据传输--从拆  除呼叫  
  - 每个分组携带虚电路标识（VCID），路径中的每个设备都要维护虚电路  连接状态  
  - 优点：可以达到预期的服务保障  
  - 每个VC分组携带VCID，而不是目的地址。VCID会被经过的路由改写替换  
  - 路由器上的VC转发表：输入接口 输入VCID 输出接口 输出VCID  
  
2.IP协议  

- 1.数据报格式（略）  
（bit）---4----------4--------------8---------------16  
首部：版本号，首部长度，服务类型（TOS），总长度  
标识  
数据：  
- 2.IP分片  
最大传输单元MTU  
1个大的IP分组可以被分成多个IP分片，用IP首部的 标识字段16bit标识，标识位字段3bit（保留，DF，MF）DF：1禁止分片。MF：1非最后  一片，片偏移13bit  
最大分片可封装的数据：d = （MTU-20）/8\*8向下取整  
需要总片数：n = （IP长度-20）/d向上取整  
片偏移量：Fi = d/8*（i-1)  
例子： 4000b数据报，MTU = 1500b  
分三片，前两片1480，后一片1040，第一片偏移量 = 0，第二片 = 1480  /8 = 185。。。
- 3.IP编址  
有类编址：A（1/2）B（1/4）C（1/8）D（1/16）E（1/16）  
无类编址：网络号和地址号，子网掩码  
- 4.DHCP  
主机通过广播地址向DHCP主机申请IP，DHCP响应，主机接收到相应，则  广播已收到响应，其他DHCP不会再响应他了，响应的DHCP服务器向其发  送DHCP报文  
- 5.NAT  
多个主机共用一个公网IP  
穿透：1.端口映射 2.中断  
- 6.ICMP互联网控制报文协议  
差错报告报文  
五类（略）  
网络探寻报文  
两类（略）  
- 7.IPv6  
改进首部格式，支持QoS，固定40字节首部，不允许分片，可以有多个扩  展首部，没有校验和，新版ICMP  
IP报文格式：略  
地址表示方法  
  
3.路由  
1.路由算法  
